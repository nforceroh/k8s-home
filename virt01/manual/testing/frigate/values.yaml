
frigate:
  image:
    # -- Docker registry/repository to pull the image from
    repository: ghcr.io/blakeblackshear/frigate
    # -- Overrides the default tag (appVersion) used in Chart.yaml ([Docker Hub](https://hub.docker.com/r/blakeblackshear/frigate/tags?page=1))
    tag: stable-tensorrt
  gpu:
    nvidia:
      # -- Enables NVIDIA GPU compatibility. Must also use the "amd64nvidia" tagged image
      enabled: true
      runtimeClassName: nvidia
  ingress:
    # -- Enables the use of an Ingress Controller to front the Service and can provide HTTPS
    enabled: true    
    ingressClassName: "traefik"
    annotations:
      cert-manager.io/cluster-issuer: "nf-lab"
      cert-manager.io/private-key-rotation-policy: "Always"
      traefik.ingress.kubernetes.io/router.entrypoints: "websecure"
      external-dns.alpha.kubernetes.io/target: "traefik.k3s.nf.lab"
    hosts:
      - host: "frigate.k3s.nf.lab"
        paths:
          - path: '/'
            portName: http

    tls:
      - secretName: "frigate-tls"
        hosts:
          - "frigate.k3s.nf.lab"

    config:
      # -- Enables persistence for the config directory
      enabled: true        
      skipuninstall: false
    media:
      # -- Enables persistence for the media directory
      enabled: true        
      skipuninstall: false    
      size: 10Gi
  config: |
    mqtt:
      # Required: host name
      host: mqtt.k3s.nf.lab
      # Optional: port (default: shown below)
      port: 1883
      # Optional: topic prefix (default: shown below)
      # WARNING: must be unique if you are running multiple instances
      topic_prefix: frigate
      # Optional: client id (default: shown below)
      # WARNING: must be unique if you are running multiple instances
      client_id: frigate
      # Optional: user
      #user: mqtt_user
      # Optional: password
      # NOTE: Environment variables that begin with 'FRIGATE_' may be referenced in {}.
      #       eg. password: '{FRIGATE_MQTT_PASSWORD}'
      #password: password
      # Optional: interval in seconds for publishing stats (default: shown below)
      stats_interval: 60

    snapshots:
      enabled: true 

    live:
      quality: 2

    birdseye:
      enabled: false

    objects:
      track:
      - person
      - car

    # model:
    #   model_type: yolonas
    #   width: 1280 # <--- should match whatever was set in notebook
    #   height: 720 # <--- should match whatever was set in notebook
    #   input_pixel_format: bgr
    #   input_tensor: nchw
    #   path: /config/yolo_nas_s.onnx
    #   labelmap_path: /labelmap/coco-80.txt

    # detectors:
    #   onnx_0:
    #     type: onnx

    cameras:
      # Name of your camera
      front_porch:
        enabled: True
        ffmpeg:
          inputs:
            - path: rtsp://scrypted-rtsp-svc:37047/ba2a319a4fd172ba
              input_args: preset-rtsp-restream
              roles:
                - detect
                - rtmp
        detect:
          width: 1280
          height: 720
          fps: 5
        objects:
          track:
            - person
            - car
            - motorcycle
            - bicycle
            - dog
            - bird